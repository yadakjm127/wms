<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mind Hub</title>

    <meta name="_csrf" th:if="${_csrf != null}" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:if="${_csrf != null}" th:content="${_csrf.headerName}" />

	<link rel="stylesheet" href="/css/base.css">
	<link rel="stylesheet" href="/css/component.css">
	<link rel="stylesheet" href="/css/admin.css">
	
</head>
<body class="admin-body">

<header class="admin-header">
    <div class="admin-header-left">
        <a href="/" class="logo-link">🧠 MIND HUB</a>
        <span class="dash-title" th:text="${pageTitle} ?: '사용자 관리'">사용자 관리</span>
    </div>

    <nav class="admin-nav-tabs">
        <a href="/admin" class="admin-tab-link">대시보드</a>
        <a href="/admin/users" class="admin-tab-link active">사용자 관리</a>
    </nav>

    <nav class="admin-header-right">
        <a href="/" class="link-home">사이트로 돌아가기</a>
        <form th:action="@{/logout}" method="post" class="logout-form">
            <input th:if="${_csrf != null}" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="logout-btn">로그아웃</button>
        </form>
    </nav>
</header>

<main class="admin-main">

    <div id="role-update-result" class="alert-box" style="display:none;"></div>

    <section class="panel">
        <h2>사용자 목록 / 권한 변경</h2>

        <div class="table-wrapper">
            <table class="user-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>아이디(username)</th>
                    <th>이름</th>
                    <th>이메일</th>
                    <th>권한</th>
                    <th>변경</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="u : ${users}">
                    <td th:text="${u.id}">1</td>
                    <td th:text="${u.username}">admin</td>
                    <td th:text="${u.name}">관리자</td>
                    <td th:text="${u.email}">admin@example.com</td>

                    <td class="role-cell"
                        th:attr="data-raw-role=${u.role}"
                        th:text="${u.role == 'ROLE_ADMIN'} ? '관리자' : '사용자'">
                        사용자
                    </td>

                    <td class="actions-cell">
                        <button class="role-btn make-admin" th:attr="data-id=${u.id},data-role='ADMIN'">관리자 지정</button>
                        <button class="role-btn make-user" th:attr="data-id=${u.id},data-role='USER'">일반 사용자</button>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(users)}">
                    <td colspan="6" style="color:#6b7280;">사용자가 없습니다.</td>
                </tr>
                </tbody>
            </table>
        </div>

    </section>
</main>

<script src="/js/common.js"></script>
<script src="/js/csrf.js"></script>
<script src="/js/admin-dashboard.js"></script>
</body>
</html>
